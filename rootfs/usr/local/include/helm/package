ifneq ($(LINT),true)
	PACKAGES ?= $(shell ls -1)
endif

define init
	@if [ ! -f "$(HELM_VALUES_PATH)/$(NAME).yaml" ]; then \
		echo "Fetching config for $(NAME) from $(PACKAGE)"; \
		mkdir -p  $(HELM_VALUES_PATH)/; \
		helm inspect values $(PACKAGE) > $(HELM_VALUES_PATH)/$(NAME).yaml; \
	fi
	@configure-yaml $(HELM_VALUES_PATH)/$(NAME).yaml;
endef

define install
	@helm install --namespace $(NAMESPACE) --name $(NAME) --values $(HELM_VALUES_PATH)/$(NAME).yaml $(PACKAGE)
endef

define upgrade
	@helm upgrade --values $(HELM_VALUES_PATH)/$(NAME).yaml $(NAME) $(PACKAGE)
endef

define uninstall
	@helm delete $(NAME) --purge
endef

define edit
	@vim $(HELM_VALUES_PATH)/$(NAME).yaml
endef

## Delete left-over packages
clean:
	@rm -f *.tgz

validate:
	@if [ ! -d "$(HELM_VALUES_PATH)" ]; then \
		echo "Cluster not mounted"; \
		exit 1; \
	fi

