#!/bin/bash

if [ "${BOOTSTRAP}" == "true" ]; then
stty -onlcr
cat<<"__EOF__"
# Please run the following commands to start the geodesic shell (modify as necessary)
DOCKER_IMAGE=${DOCKER_IMAGE:-cloudposse/geodesic}
DOCKER_TAG=${DOCKER_TAG:-dev}
STATE_DIR=${STATE_DIR:-${HOME}/.geodesic}
mkdir -p ${STATE_DIR}
docker run --env BOOTSTRAP=false --env LS_COLORS --env TERM --env TERM_COLOR --env SSH_AUTH_SOCK --rm -it --volume ${STATE_DIR}:/geodesic/config ${DOCKER_IMAGE}:${DOCKER_TAG} $*
__EOF__
exit 0
fi

echo "Entering the geodesic shell..."
alias make='make -C /geodesic'
mkdir -p $(dirname ${TF_STATE_FILE})
mkdir -p $(dirname ${KUBECONFIG})
mkdir -p $(dirname ${AWS_SHARED_CREDENTIALS_FILE})
mkdir -p $(dirname ${AWS_CONFIG_FILE})
mkdir -p ${AWS_DATA_PATH}
ln -sf ${AWS_DATA_PATH} ${HOME}/.aws
. /usr/local/bin/profile
