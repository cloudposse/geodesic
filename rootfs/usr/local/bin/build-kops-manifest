#!/bin/bash
KOPS_TEMPLATE="${1:-$KOPS_TEMPLATE}"
KOPS_MANIFEST="${2:-$KOPS_MANIFEST}"
KOPS_CONF_DIR="$(dirname "$KOPS_MANIFEST")"
EXTRA_ARGS=${@:3}
GOMPLATE_EXTRA_ARGS=${EXTRA_ARGS:-$GOMPLATE_EXTRA_ARGS}

mkdir -p ${KOPS_CONF_DIR}

direnv exec ${KOPS_CONF_DIR} gomplate ${GOMPLATE_EXTRA_ARGS} -f ${KOPS_TEMPLATE} >${KOPS_MANIFEST}

echo "Wrote manifest to ${KOPS_MANIFEST}..."
