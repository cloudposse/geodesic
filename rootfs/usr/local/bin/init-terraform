#!/usr/bin/env bash
shopt -s nullglob

TF_BUCKET_REGION=${TF_BUCKET_REGION:-us-east-1}
TF_BUCKET_PREFIX=${TF_BUCKET_PREFIX:-$(basename `pwd`)}
TF_FILE=${TF_FILE:-terraform.tfstate}
TF_FILES=(*.tf)

[ ! -z ${TF_FILES} ] || (echo "Run $0 from a terraform project directory"; exit 1)

terraform init \
	-backend=true \
	-backend-config="bucket=${TF_BUCKET}" \
	-backend-config="key=${TF_BUCKET_PREFIX}/${TF_FILE}" \
	-backend-config="region=${TF_BUCKET_REGION}" \
	-backend-config="profile=${AWS_PROFILE}" \
	-backend-config="role_arn=${AWS_SUBACCOUNT_ROLE}"
