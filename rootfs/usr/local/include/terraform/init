DIR ?= .

## Configure Terraform to use remote S3 bucket
init:
	$(call assert-set,DIR)
	@mkdir -p $(TF_STATE_DIR)
	@rm -rf $(DIR)/.terraform
	@ln -s $(TF_STATE_DIR) $(DIR)/.terraform
	@terraform init \
		-backend=true \
		-backend-config="bucket=$(TF_BUCKET)" \
		-backend-config="key=$(TF_BUCKET_PREFIX)/geodesic.tfstate" \
		-backend-config="region=$(AWS_REGION)" \
		-backend-config="profile=$(AWS_PROFILE)" \
		-backend-config="role_arn=$(AWS_ASSUME_ROLE_ARN)"
